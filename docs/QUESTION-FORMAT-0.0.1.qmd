# QUESTION-FORMAT-0.0.1.qmd"

This document defines how questions are stored on the **filesystem** for the initial MVP. It is referenced by SPEC-0.0.1.qmd.

All structured data uses **YAML** for readability and easy hand-editing. Prefer **multiple small files** over one large file so authors can edit one concern at a time.

---

## One Folder per Question

- Each question has its **own folder**.
- Folder name SHOULD be the question **id** (e.g. `q-bash-ls-001` or a UUID) so that updates can replace the same folder.
- All question content and metadata for that question live inside this folder.

---

## Required Files

### `meta.yaml` (required)

Minimal metadata that identifies and classifies the question. Keep this file short so it’s easy to scan and edit.

**Required fields:**

| Field    | Type   | Description |
|----------|--------|-------------|
| `id`     | string | Unique question id (SHOULD match folder name). |
| `type`   | string | Question type (see Section 4). |
| `version`| string | Version (e.g. `1`, `1.0.1`, or date). Bump when the question changes. |

**Optional (recommended):**

| Field         | Type   | Description |
|---------------|--------|-------------|
| `title`       | string | Short title for admin/author UIs. |
| `domain`      | string | Knowledge domain (e.g. `bash`, `r`, `regex`, `excel`, `html`, `css`). |
| `created_at`  | string | ISO 8601 date (author or system on first upload). |
| `modified_at` | string | ISO 8601 date (system on each modification upload). |

Example:

```yaml
id: q-bash-ls-001
type: bash
version: "1"
title: List files in current directory
domain: bash
```

### Prompt file: `prompt.md` or `prompt.txt` (required)

- The question text shown to the student.
- **Exactly one** prompt file is required per question: either `prompt.md` (Markdown) or `prompt.txt` (plain text).
- **If both are present**: The system MUST use **`prompt.md`** and MUST ignore `prompt.txt`. (Markdown takes precedence so that authors can add a `.txt` fallback without changing runtime behavior.)
- **If neither is present**: The question is **invalid**; upload MUST be rejected and the question MUST NOT be used for tests until a prompt file is added.
- **Recommendation**: Authors should include only one of the two to avoid confusion; the system does not validate or warn when both exist.

---

## Type-Specific Files

Depending on `type`, the folder may include additional files. All paths are relative to the question folder. Use one file per concern where possible.

### Multiple choice (`type: multiple_choice`)

**`options.yaml`** (required) — list of choices. Mark the correct one with `correct: true`. Use simple keys so authors can add options without learning a schema.

Example:

```yaml
# options.yaml — one entry per choice; exactly one should have correct: true
- id: a
  text: Option A
  correct: true
- id: b
  text: Option B
- id: c
  text: Option C
```

Alternative: if you prefer to list the correct id separately (e.g. for long option lists), you can use a single `correct_id` in a small wrapper. The system MAY support:

```yaml
correct_id: a
options:
  - id: a
    text: Option A
  - id: b
    text: Option B
```

MVP implementation chooses one convention; the first (inline `correct: true`) is recommended for readability.

### Short answer (`type: short_answer`)

**`expected.yaml`** (optional) — expected answer(s) or grading hint. Prefer one simple field when that’s enough.

Example (single expected answer):

```yaml
answer: "the exact expected string"
```

Example (multiple accepted answers):

```yaml
answers:
  - "first acceptable answer"
  - "second acceptable answer"
```

**`rubric.yaml`** (optional) — use when grading is criteria-based. Keep criteria as a simple list.

Example:

```yaml
criteria:
  - Must mention X
  - Must include at least one example
points_per_criterion: 5
```

Exact schema can be refined per evaluator; the above are easy to type and modify.

### Long answer (`type: long_answer`)

Same as short answer: **`expected.yaml`** and/or **`rubric.yaml`**. Use `rubric.yaml` when feedback is criteria-based rather than a single string match.

### R / Bash coding (`type: r` or `type: bash`)

- **`solution.R`** or **`solution.sh`** (required) — reference solution. Used to generate or compare outputs.
- **`tests.yaml`** (optional) — explicit test inputs/scenarios. If absent, the system may derive tests from the solution or another spec.

Keep `tests.yaml` as one scenario per list item so authors can add/remove tests without editing a big structure.

Example for Bash:

```yaml
# tests.yaml — each item is one test scenario (e.g. inputs or description)
- description: "Empty directory"
  stdin: ""
  # optional: env, cwd, etc. TBD per evaluator
- description: "Directory with two files"
  stdin: ""
  setup: "touch foo bar"
```

Example for R (conceptual):

```yaml
# tests.yaml — inputs passed to the solution / user code
- description: "Default case"
  inputs:
    x: 1
    y: 2
- description: "Edge case"
  inputs:
    x: 0
    y: 0
```

Exact keys (e.g. `stdin`, `inputs`, `setup`) depend on the evaluator; the format should stay list-based and readable.

### Excel, HTML, CSS

- **Excel formula / HTML / CSS**: Add in a later revision. Prefer separate files (e.g. `expected.yaml` for formula or snippet, optional asset files) and the same readability guidelines.

---

## Question Type Values (MVP)

Use lowercase. Canonical list:

| Type              | Description                    |
|-------------------|--------------------------------|
| `multiple_choice` | Single correct choice          |
| `short_answer`    | Short text, single/multiple expected answers or rubric |
| `long_answer`     | Longer text, rubric or expected answer |
| `r`               | R code                         |
| `bash`            | Bash commands/script           |
| `excel_formula`   | (optional in MVP)              |
| `html`            | (optional in MVP)              |
| `css`             | (optional in MVP)              |

The SPEC defines which types are implemented in the initial MVP.

---

## Upload and Versioning

- **New question**: Author provides a folder (or zip that unpacks to one folder) containing at least `meta.yaml` and `prompt.md` or `prompt.txt`. System stores it under the questions root and may set `created_at` / `modified_at` in `meta.yaml`.
- **Modification**: Author uploads updated files for an existing `id`. System overwrites/updates files and updates `modified_at` (and optionally `version` in `meta.yaml`; author may supply the new version in the upload).
- **Validation**: On upload, the system MUST validate presence of `id`, `type`, and `version` in `meta.yaml` and the presence of exactly one prompt source (see Section 2.2 and Section 6); type-specific requirements are validated as in Section 6.

---

## Edge Cases and Deterministic Behavior

The following rules remove ambiguity. Implementations MUST behave as specified.

### Prompt file

| Scenario | Behavior |
|---------|----------|
| Both `prompt.md` and `prompt.txt` present | Use **`prompt.md`**; ignore `prompt.txt`. |
| Only `prompt.md` present | Use `prompt.md`. |
| Only `prompt.txt` present | Use `prompt.txt`. |
| Neither present | **Invalid.** Reject upload; do not use question. |

### `meta.yaml` identity and type

| Scenario | Behavior |
|---------|----------|
| `id` in `meta.yaml` differs from folder name | **Invalid.** Reject upload (or treat as invalid when loading). Folder name is the canonical id; `meta.yaml` `id` MUST match. |
| `type` missing or empty | **Invalid.** Reject upload. |
| `type` not in the canonical list (Section 4) | **Invalid.** Reject upload. |
| `version` missing or empty | **Invalid.** Reject upload. |

### Type-specific required files

| Question type | Required files | If missing |
|---------------|----------------|------------|
| `multiple_choice` | `options.yaml` | **Invalid.** Reject upload. |
| `short_answer` / `long_answer` | (none beyond meta + prompt) | Valid; grading may use defaults or fail gracefully per evaluator. |
| `r` | `solution.R` | **Invalid.** Reject upload. |
| `bash` | `solution.sh` | **Invalid.** Reject upload. |

For types not yet defined (e.g. `excel_formula`, `html`, `css`), required files are specified when the type is added.

### Multiple choice options

| Scenario | Behavior |
|---------|----------|
| No option has `correct: true` | **Invalid.** Reject upload (or reject when loading). |
| More than one option has `correct: true` | **Invalid.** Reject upload (or reject when loading). |
| `options.yaml` missing or empty list | **Invalid.** Reject upload. |
| Duplicate option `id` values | **Invalid.** Reject upload. |

### Malformed or missing YAML

| Scenario | Behavior |
|---------|----------|
| `meta.yaml` missing | **Invalid.** Reject upload. |
| `meta.yaml` not valid YAML | **Invalid.** Reject upload; return parse error to author. |
| Type-specific YAML (e.g. `options.yaml`) not valid YAML | **Invalid.** Reject upload; return parse error. |

### 6.6 Modification uploads (existing question id)

| Scenario | Behavior |
|---------|----------|
| Upload targets existing id but folder name in upload differs from id | **Invalid.** Reject; id is defined by the target existing folder, not by the uploaded folder name. |
| Modification upload omits `meta.yaml` | System MAY allow “partial” update (update only provided files). If meta is not provided, do not change `id`, `type`, or `version`; MAY update `modified_at` from system time. |
| Modification upload omits prompt file | Do not remove or overwrite existing prompt; leave existing prompt in place. |

---

## Example Folder Layouts

**Multiple choice:**

```
questions/
  q-mult-001/
    meta.yaml
    prompt.md
    options.yaml
```

**Bash coding:**

```
questions/
  q-bash-ls-001/
    meta.yaml
    prompt.md
    solution.sh
    tests.yaml
```

**Short answer with rubric:**

```
questions/
  q-short-001/
    meta.yaml
    prompt.md
    rubric.yaml
```

**R coding (minimal — no tests file):**

```
questions/
  q-r-001/
    meta.yaml
    prompt.md
    solution.R
```

This format lets authors develop and version questions locally (e.g. with Git) and upload when connected. YAML and separate files keep each piece easy to read and edit. For behavior when files are missing or conflict, see Section 6.
