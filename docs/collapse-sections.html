<style>
  .collapse-section-buttons { margin-bottom: 1em; }
  .collapse-section-buttons button { margin-right: 0.5em; }
  details.collapsible-section { margin-top: 0.5em; }
  details.collapsible-section > summary { cursor: pointer; list-style: none; display: flex; align-items: center; gap: 0.25em; }
  details.collapsible-section > summary::-webkit-details-marker { display: none; }
  details.collapsible-section > summary::before { content: "â–¸"; display: inline-block; transition: transform 0.2s; }
  details.collapsible-section[open] > summary::before { transform: rotate(90deg); }
  details.collapsible-section .section-content { margin-left: 1em; margin-top: 0.25em; }
</style>
<script>
(function() {
  function initCollapsibleSections() {
    const main = document.getElementById("quarto-document-content");
    if (!main) return;

    function wrapSection(section) {
      const id = section.id;
      const heading = section.querySelector("h2, h3, h4");
      if (!heading) return;

      const levelClass = section.classList.contains("level4") ? "level4" : section.classList.contains("level3") ? "level3" : "level2";
      const details = document.createElement("details");
      details.className = "collapsible-section " + levelClass;
      if (id) details.id = id;
      details.open = true;

      const summary = document.createElement("summary");
      summary.appendChild(heading);

      const content = document.createElement("div");
      content.className = "section-content";
      while (section.childNodes.length > 0) {
        const child = section.childNodes[0];
        if (child === heading) {
          section.removeChild(child);
          continue;
        }
        content.appendChild(section.childNodes[0]);
      }

      details.appendChild(summary);
      details.appendChild(content);
      section.parentNode.replaceChild(details, section);
    }

    // Process innermost sections first (level4, then level3, then level2)
    [].slice.call(main.querySelectorAll("section.level4")).forEach(wrapSection);
    [].slice.call(main.querySelectorAll("section.level3")).forEach(wrapSection);
    [].slice.call(main.querySelectorAll("section.level2")).forEach(wrapSection);

    // Insert Expand all / Collapse all buttons before first collapsible section
    const firstDetails = main.querySelector("details.collapsible-section");
    if (firstDetails) {
      const btnWrap = document.createElement("div");
      btnWrap.className = "collapse-section-buttons";
      btnWrap.innerHTML = "<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"expand-all-sections\">Expand all</button> <button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"collapse-all-sections\">Collapse all</button>";
      main.insertBefore(btnWrap, firstDetails);

      document.getElementById("expand-all-sections").onclick = function() {
        main.querySelectorAll("details.collapsible-section").forEach(function(d) { d.open = true; });
      };
      document.getElementById("collapse-all-sections").onclick = function() {
        main.querySelectorAll("details.collapsible-section").forEach(function(d) { d.open = false; });
      };
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initCollapsibleSections);
  } else {
    initCollapsibleSections();
  }
})();
</script>
